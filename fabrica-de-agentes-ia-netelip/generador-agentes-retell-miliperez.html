<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Prompts - F치brica de Agentes IA | Netelip</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <style>
        :root {
            --netelip-blue: #267ab0;
            --netelip-light-gray: #f0f0ef;
            --netelip-dark-blue: #222d32;
            --netelip-success: #28a745;
            --netelip-warning: #ffc107;
            --netelip-danger: #dc3545;
        }
        
        body {
            background-color: var(--netelip-light-gray);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .wizard-container {
            max-width: 900px;
            margin: 40px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .wizard-header {
            background: linear-gradient(135deg, var(--netelip-blue) 0%, var(--netelip-dark-blue) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .wizard-header h1 {
            font-size: 28px;
            font-weight: 600;
            margin: 0 0 10px 0;
        }
        
        .wizard-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 15px;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            padding: 25px 40px;
            background: white;
            border-bottom: 2px solid var(--netelip-light-gray);
        }
        
        .step-item {
            flex: 1;
            text-align: center;
            position: relative;
        }
        
        .step-item:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: #e0e0e0;
            z-index: 0;
        }
        
        .step-item.active:not(:last-child)::after {
            background: var(--netelip-blue);
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #666;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .step-item.active .step-number {
            background: var(--netelip-blue);
            color: white;
            transform: scale(1.1);
        }
        
        .step-item.completed .step-number {
            background: var(--netelip-success);
            color: white;
        }
        
        .step-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }
        
        .step-item.active .step-label {
            color: var(--netelip-blue);
            font-weight: 600;
        }
        
        .wizard-content {
            padding: 40px;
            min-height: 500px;
        }
        
        .step-content {
            display: none;
        }
        
        .step-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--netelip-dark-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 25px;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--netelip-dark-blue);
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-control, .form-select {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px 15px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--netelip-blue);
            box-shadow: 0 0 0 0.2rem rgba(38, 122, 176, 0.15);
        }
        
        .module-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .module-card:hover {
            border-color: var(--netelip-blue);
            box-shadow: 0 4px 12px rgba(38, 122, 176, 0.1);
        }
        
        .module-card.selected {
            border-color: var(--netelip-blue);
            background: rgba(38, 122, 176, 0.05);
        }
        
        .module-header {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .module-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: var(--netelip-blue);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .module-info {
            flex: 1;
        }
        
        .module-title {
            font-weight: 600;
            color: var(--netelip-dark-blue);
            margin-bottom: 3px;
            font-size: 16px;
        }
        
        .module-description {
            color: #666;
            font-size: 13px;
            margin: 0;
        }
        
        .module-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }
        
        .wizard-actions {
            display: flex;
            justify-content: space-between;
            padding: 25px 40px;
            background: var(--netelip-light-gray);
            border-top: 2px solid #e0e0e0;
        }
        
        .btn-wizard {
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-wizard-prev {
            background: white;
            color: var(--netelip-dark-blue);
            border: 2px solid #e0e0e0;
        }
        
        .btn-wizard-prev:hover {
            border-color: var(--netelip-blue);
            color: var(--netelip-blue);
        }
        
        .btn-wizard-next {
            background: var(--netelip-blue);
            color: white;
        }
        
        .btn-wizard-next:hover {
            background: var(--netelip-dark-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(38, 122, 176, 0.3);
        }
        
        .btn-wizard-create {
            background: var(--netelip-success);
            color: white;
        }
        
        .btn-wizard-create:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        
        .info-tooltip {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--netelip-blue);
            color: white;
            font-size: 12px;
            margin-left: 5px;
            cursor: help;
        }
        
        .config-section {
            background: var(--netelip-light-gray);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .config-section-title {
            font-weight: 600;
            color: var(--netelip-dark-blue);
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .summary-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .summary-title {
            font-weight: 600;
            color: var(--netelip-dark-blue);
            margin-bottom: 12px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .summary-label {
            color: #666;
            font-size: 14px;
        }
        
        .summary-value {
            font-weight: 600;
            color: var(--netelip-dark-blue);
            font-size: 14px;
        }
        
        .alert-custom {
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: none;
        }
        
        .alert-info {
            background: rgba(38, 122, 176, 0.1);
            color: var(--netelip-blue);
        }
        
        .alert-success {
            background: rgba(40, 167, 69, 0.1);
            color: var(--netelip-success);
        }
        
        .alert-warning {
            background: rgba(255, 193, 7, 0.1);
            color: #856404;
        }
        
        .prompt-preview {
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .btn-preview {
            background: var(--netelip-dark-blue);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn-preview:hover {
            background: var(--netelip-blue);
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner-border {
            color: var(--netelip-blue);
        }
        
        .hidden {
            display: none;
        }
        
        .personality-option {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .personality-option:hover {
            border-color: var(--netelip-blue);
        }
        
        .personality-option.selected {
            border-color: var(--netelip-blue);
            background: rgba(38, 122, 176, 0.05);
        }
        
        .personality-option input[type="radio"] {
            margin-right: 10px;
        }
        
        .personality-label {
            font-weight: 600;
            color: var(--netelip-dark-blue);
            margin-bottom: 3px;
        }
        
        .personality-desc {
            color: #666;
            font-size: 13px;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="wizard-container">
        <!-- Header -->
        <div class="wizard-header">
            <h1><i class="bi bi-gear-fill"></i> Generador de Prompts IA</h1>
            <p>Crea prompts optimizados para tus agentes de voz en 8 pasos simples</p>
        </div>
        
        <!-- Progress Steps -->
        <div class="progress-steps">
            <div class="step-item active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">B치sico</div>
            </div>
            <div class="step-item" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">Capacidades</div>
            </div>
            <div class="step-item" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label">Cualificaci칩n</div>
            </div>
            <div class="step-item" data-step="4">
                <div class="step-number">4</div>
                <div class="step-label">Transferencias</div>
            </div>
            <div class="step-item" data-step="5">
                <div class="step-number">5</div>
                <div class="step-label">Agendamiento</div>
            </div>
            <div class="step-item" data-step="6">
                <div class="step-number">6</div>
                <div class="step-label">Personalidad</div>
            </div>
            <div class="step-item" data-step="7">
                <div class="step-number">7</div>
                <div class="step-label">Avanzado</div>
            </div>
            <div class="step-item" data-step="8">
                <div class="step-number">8</div>
                <div class="step-label">Resumen</div>
            </div>
        </div>
        
        <!-- Wizard Content -->
        <div class="wizard-content">
            <!-- PASO 1: Informaci칩n B치sica -->
            <div class="step-content active" data-step="1">
                <div class="section-title">
                    <i class="bi bi-info-circle-fill"></i>
                    Informaci칩n b치sica del agente
                </div>
                <div class="section-subtitle">
                    Configura los datos fundamentales de tu agente de voz
                </div>
                
                <div class="alert-custom alert-info">
                    <i class="bi bi-lightbulb-fill" style="font-size: 20px;"></i>
                    <div>
                        <strong>Consejo:</strong> Elige un nombre memorable y cercano para tu agente. Este ser치 el nombre que usar치 al presentarse con los contactos.
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="form-label">
                        Nombre del agente
                        <span class="info-tooltip" data-bs-toggle="tooltip" title="Nombre que usar치 el agente al presentarse (ej: Elio, Sofia, Carlos)">?</span>
                    </label>
                    <input type="text" class="form-control" id="agentName" placeholder="Ej: Elio" required>
                </div>
                
                <div class="mb-4">
                    <label class="form-label">
                        Nombre de la empresa/marca
                        <span class="info-tooltip" data-bs-toggle="tooltip" title="Empresa a la que representa el agente">?</span>
                    </label>
                    <input type="text" class="form-control" id="companyName" placeholder="Ej: Netelip" required>
                </div>
                
                <div class="mb-4">
                    <label class="form-label">
                        Sector o servicios principales
                        <span class="info-tooltip" data-bs-toggle="tooltip" title="Describe brevemente el sector o servicios de tu empresa">?</span>
                    </label>
                    <textarea class="form-control" id="services" rows="3" placeholder="Ej: Centralitas virtuales, telefon칤a VoIP, soluciones de comunicaci칩n empresarial"></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="form-label">
                        Objetivo principal del agente
                        <span class="info-tooltip" data-bs-toggle="tooltip" title="쯈u칠 debe lograr principalmente tu agente?">?</span>
                    </label>
                    <textarea class="form-control" id="mainObjective" rows="3" placeholder="Ej: Cualificar contactos, agendar citas con asesores y conectar clientes con los departamentos adecuados"></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="form-label">
                        Mensaje inicial del agente
                        <span class="info-tooltip" data-bs-toggle="tooltip" data-bs-placement="top" title="Primera frase que dir치 el agente al contestar la llamada. Por ley (GDPR/LOPD) debe identificarse como IA, mencionar la empresa e informar sobre la grabaci칩n.">?</span>
                    </label>
                    <input type="text" class="form-control" id="beginMessage" placeholder="Se generar치 autom치ticamente al completar nombre y empresa">
                    <div class="alert-custom alert-warning mt-2" style="padding: 10px 15px; margin-bottom: 0;">
                        <i class="bi bi-shield-check" style="font-size: 16px;"></i>
                        <div style="font-size: 13px;">
                            <strong>Cumplimiento GDPR/LOPD:</strong> El mensaje se genera autom치ticamente incluyendo que el agente es IA y que la llamada se graba. Puedes editarlo manualmente si lo necesitas.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PASO 2: Capacidades (M칩dulos) -->
            <div class="step-content" data-step="2">
                <div class="section-title">
                    <i class="bi bi-toggles2"></i>
                    Capacidades del agente
                </div>
                <div class="section-subtitle">
                    Selecciona qu칠 funcionalidades tendr치 tu agente de voz
                </div>
                
                <div class="alert-custom alert-info">
                    <i class="bi bi-lightbulb-fill" style="font-size: 20px;"></i>
                    <div>
                        <strong>Tip:</strong> Puedes activar uno, dos o los tres m칩dulos seg칰n las necesidades de tu negocio. Cada m칩dulo es completamente independiente.
                    </div>
                </div>
                
                <!-- M칩dulo 1: Cualificaci칩n -->
                <div class="module-card" data-module="cualificacion">
                    <div class="module-header">
                        <div class="module-icon">
                            <i class="bi bi-patch-question-fill"></i>
                        </div>
                        <div class="module-info">
                            <div class="module-title">Cualificaci칩n de contactos</div>
                            <p class="module-description">El agente har치 preguntas para clasificar y entender qu칠 necesita cada contacto</p>
                        </div>
                        <input type="checkbox" class="module-checkbox" id="moduleCualificacion">
                    </div>
                </div>
                
                <!-- M칩dulo 2: Transferencia -->
                <div class="module-card" data-module="transferencia">
                    <div class="module-header">
                        <div class="module-icon">
                            <i class="bi bi-telephone-forward-fill"></i>
                        </div>
                        <div class="module-info">
                            <div class="module-title">Transferencia de llamadas</div>
                            <p class="module-description">Conecta al contacto con diferentes departamentos o personas seg칰n sus necesidades</p>
                        </div>
                        <input type="checkbox" class="module-checkbox" id="moduleTransferencia">
                    </div>
                </div>
                
                <!-- M칩dulo 3: Agendamiento -->
                <div class="module-card" data-module="agendamiento">
                    <div class="module-header">
                        <div class="module-icon">
                            <i class="bi bi-calendar-check-fill"></i>
                        </div>
                        <div class="module-info">
                            <div class="module-title">Agendamiento de citas</div>
                            <p class="module-description">Reserva citas autom치ticamente en tu calendario Cal.com con los horarios disponibles</p>
                        </div>
                        <input type="checkbox" class="module-checkbox" id="moduleAgendamiento">
                    </div>
                </div>
            </div>
            
            <!-- PASO 3: Configuraci칩n Cualificaci칩n -->
            <div class="step-content" data-step="3">
                <div class="section-title">
                    <i class="bi bi-patch-question-fill"></i>
                    Configuraci칩n de cualificaci칩n
                </div>
                <div class="section-subtitle">
                    Define las preguntas que har치 tu agente para clasificar a los contactos
                </div>
                
                <div class="alert-custom alert-warning">
                    <i class="bi bi-exclamation-triangle-fill" style="font-size: 20px;"></i>
                    <div>
                        <strong>Importante:</strong> Las preguntas deben ser claras y directas. El agente har치 una pregunta a la vez y esperar치 respuesta.
                    </div>
                </div>
                
                <div class="config-section">
                    <div class="config-section-title">
                        <i class="bi bi-1-circle-fill"></i>
                        Pregunta Q1: Clasificaci칩n inicial
                    </div>
                    <input type="text" class="form-control mb-2" id="q1" placeholder="Ej: 쮼res ya cliente de [empresa] o quieres informaci칩n para empezar?">
                    <small class="text-muted">Esta pregunta ayuda a identificar si es cliente actual o potencial</small>
                </div>
                
                <div class="config-section">
                    <div class="config-section-title">
                        <i class="bi bi-2-circle-fill"></i>
                        Pregunta Q2: Motivo de contacto
                    </div>
                    <input type="text" class="form-control mb-2" id="q2" placeholder="Ej: 쮼n qu칠 puedo ayudarte?">
                    <small class="text-muted">Pregunta abierta para conocer la necesidad espec칤fica</small>
                </div>
                
                <div class="config-section">
                    <div class="config-section-title">
                        <i class="bi bi-3-circle-fill"></i>
                        Pregunta Q3: Propuesta de acci칩n (solo para NO clientes)
                    </div>
                    <input type="text" class="form-control mb-2" id="q3" placeholder="Ej: 쯊e gustar칤a agendar una cita con un asesor para que te d칠 informaci칩n detallada?">
                    <small class="text-muted">Se usa solo cuando el contacto NO es cliente actual</small>
                </div>
            </div>
            
            <!-- PASO 4: Configuraci칩n Transferencias -->
            <div class="step-content" data-step="4">
                <div class="section-title">
                    <i class="bi bi-telephone-forward-fill"></i>
                    Configuraci칩n de transferencias
                </div>
                <div class="section-subtitle">
                    Define los destinos a donde puede transferir las llamadas tu agente
                </div>
                
                <div class="alert-custom alert-info">
                    <i class="bi bi-lightbulb-fill" style="font-size: 20px;"></i>
                    <div>
                        <strong>Consejo:</strong> Configura al menos 2 destinos diferentes (ej: atenci칩n al cliente y soporte t칠cnico) para mejor clasificaci칩n.
                    </div>
                </div>
                
                <!-- Transferencia 1 -->
                <div class="config-section">
                    <div class="config-section-title">
                        <i class="bi bi-telephone-fill"></i>
                        Destino de transferencia 1
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Nombre del destino</label>
                        <input type="text" class="form-control" id="transfer1Name" placeholder="Ej: Atenci칩n al cliente">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">N칰mero de tel칠fono</label>
                        <input type="text" class="form-control" id="transfer1Number" placeholder="Ej: +34912345678">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Criterio de transferencia</label>
                        <textarea class="form-control" id="transfer1Criteria" rows="2" placeholder="Ej: Si el contacto ES cliente y necesita ayuda con consultas comerciales, documentaci칩n o informaci칩n de cuenta"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Mensaje antes de transferir</label>
                        <input type="text" class="form-control" id="transfer1Message" placeholder="Ej: Perfecto, te paso ahora mismo con nuestro equipo de atenci칩n al cliente">
                    </div>
                </div>
                
                <!-- Transferencia 2 -->
                <div class="config-section">
                    <div class="config-section-title">
                        <i class="bi bi-telephone-fill"></i>
                        Destino de transferencia 2
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Nombre del destino</label>
                        <input type="text" class="form-control" id="transfer2Name" placeholder="Ej: Soporte t칠cnico">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">N칰mero de tel칠fono</label>
                        <input type="text" class="form-control" id="transfer2Number" placeholder="Ej: +34912345679">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Criterio de transferencia</label>
                        <textarea class="form-control" id="transfer2Criteria" rows="2" placeholder="Ej: Si el contacto ES cliente y necesita ayuda con configuraci칩n t칠cnica, incidencias o problemas con el servicio"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Mensaje antes de transferir</label>
                        <input type="text" class="form-control" id="transfer2Message" placeholder="Ej: Entiendo, te conecto ahora mismo con nuestro equipo de soporte t칠cnico">
                    </div>
                </div>
            </div>
            
            <!-- PASO 5: Configuraci칩n Agendamiento -->
            <div class="step-content" data-step="5">
                <div class="section-title">
                    <i class="bi bi-calendar-check-fill"></i>
                    Configuraci칩n de agendamiento
                </div>
                <div class="section-subtitle">
                    Conecta tu calendario Cal.com para reservas autom치ticas
                </div>
                
                <div class="alert-custom alert-warning">
                    <i class="bi bi-exclamation-triangle-fill" style="font-size: 20px;"></i>
                    <div>
                        <strong>Requisito:</strong> Necesitas una cuenta en Cal.com y configurar un tipo de evento para que funcione la integraci칩n.
                    </div>
                </div>
                
                <div class="config-section">
                    <div class="config-section-title">
                        <i class="bi bi-calendar2-week-fill"></i>
                        Configuraci칩n de Cal.com
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">
                            URL de tu calendario Cal.com
                            <span class="info-tooltip" data-bs-toggle="tooltip" title="Tu URL personalizada de Cal.com (ej: cal.com/tunombre)">?</span>
                        </label>
                        <input type="text" class="form-control" id="calendarUrl" placeholder="Ej: cal.com/netelip-asesores">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">
                            Cal.com API Key
                            <span class="info-tooltip" data-bs-toggle="tooltip" title="Obt칠n tu API Key en: cal.com/settings/developer">?</span>
                        </label>
                        <input type="password" class="form-control" id="calApiKey" placeholder="cal_live_xxxxxxxxxxxxxxxxxx">
                        <small class="text-muted">La API Key es confidencial y se almacenar치 de forma segura</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">
                            Event Type ID
                            <span class="info-tooltip" data-bs-toggle="tooltip" title="ID num칠rico del tipo de evento en Cal.com">?</span>
                        </label>
                        <input type="number" class="form-control" id="calEventTypeId" placeholder="Ej: 123456">
                        <small class="text-muted">Encuentra este ID en la configuraci칩n de tu tipo de evento en Cal.com</small>
                    </div>
                </div>
                
                <div class="config-section">
                    <div class="config-section-title">
                        <i class="bi bi-chat-left-text-fill"></i>
                        Mensajes para agendamiento
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Mensaje al consultar disponibilidad</label>
                        <input type="text" class="form-control" id="checkAvailabilityMessage" placeholder="Ej: Excelente. D칠jame consultar qu칠 horarios tenemos disponibles...">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Mensaje de confirmaci칩n de cita</label>
                        <input type="text" class="form-control" id="confirmationMessage" placeholder="Ej: Listo, {nombre}. Tu cita est치 confirmada para el {fecha_hora}. Recibir치s un correo de confirmaci칩n.">
                        <small class="text-muted">Puedes usar {nombre} y {fecha_hora} como variables</small>
                    </div>
                </div>
            </div>
            
            <!-- PASO 6: Tono y Personalidad -->
            <div class="step-content" data-step="6">
                <div class="section-title">
                    <i class="bi bi-emoji-smile-fill"></i>
                    Tono y personalidad
                </div>
                <div class="section-subtitle">
                    Define c칩mo se comunicar치 tu agente con los contactos
                </div>
                
                <div class="alert-custom alert-info">
                    <i class="bi bi-lightbulb-fill" style="font-size: 20px;"></i>
                    <div>
                        <strong>Base s칩lida:</strong> Tu agente siempre ser치 cercano, emp치tico y profesional. Aqu칤 puedes ajustar matices adicionales.
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="form-label">Estilo de comunicaci칩n principal</label>
                    
                    <div class="personality-option" data-personality="standard">
                        <label>
                            <input type="radio" name="personality" value="standard" checked>
                            <span class="personality-label">Est치ndar (Recomendado)</span>
                        </label>
                        <p class="personality-desc">Cercano, emp치tico y amable. Va al grano siendo eficiente pero manteniendo un tono c치lido y profesional.</p>
                    </div>
                    
                    <div class="personality-option" data-personality="formal">
                        <label>
                            <input type="radio" name="personality" value="formal">
                            <span class="personality-label">M치s formal</span>
                        </label>
                        <p class="personality-desc">Mantiene cercan칤a pero con un tono m치s corporativo y protocolar. Ideal para sectores como banca, legal o consultor칤a.</p>
                    </div>
                    
                    <div class="personality-option" data-personality="casual">
                        <label>
                            <input type="radio" name="personality" value="casual">
                            <span class="personality-label">M치s casual</span>
                        </label>
                        <p class="personality-desc">Conversaci칩n relajada y natural, como entre amigos. Perfecto para negocios j칩venes, startups o comercio informal.</p>
                    </div>
                </div>
                
                <div class="config-section">
                    <div class="config-section-title">
                        <i class="bi bi-sliders"></i>
                        Ajustes adicionales de personalidad
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Variantes de respuestas entusiastas</label>
                        <input type="text" class="form-control" id="enthusiasticWords" placeholder="Ej: Genial, Perfecto, Estupendo, Excelente, Fant치stico" value="Genial, Perfecto, Estupendo, Excelente, Fant치stico">
                        <small class="text-muted">Separados por comas. El agente los usar치 de forma variada</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Palabras de relleno naturales (usar con moderaci칩n)</label>
                        <input type="text" class="form-control" id="fillerWords" placeholder="Ej: umm, entonces, a ver, d칠jame ver" value="umm, entonces, a ver, d칠jame ver">
                        <small class="text-muted">M치ximo una cada 4 interacciones para naturalidad</small>
                    </div>
                </div>
            </div>
            
            <!-- PASO 7: Configuraci칩n Avanzada -->
            <div class="step-content" data-step="7">
                <div class="section-title">
                    <i class="bi bi-cpu-fill"></i>
                    Configuraci칩n t칠cnica avanzada
                </div>
                <div class="section-subtitle">
                    Par치metros t칠cnicos del modelo de IA y comportamiento del agente
                </div>
                
                <div class="config-section">
                    <div class="config-section-title">
                        <i class="bi bi-robot"></i>
                        Modelo de IA
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">
                            Modelo de lenguaje
                            <span class="info-tooltip" data-bs-toggle="tooltip" title="El modelo de IA que procesar치 las conversaciones">?</span>
                        </label>
                        <select class="form-select" id="modelSelect">
                            <option value="gemini-2.0-flash" selected>Gemini 2.0 Flash (Recomendado - R치pido y eficiente)</option>
                            <option value="gpt-4.1">GPT-4.1 (M치xima calidad)</option>
                            <option value="gpt-4.1-mini">GPT-4.1 Mini (Econ칩mico)</option>
                            <option value="claude-3.7-sonnet">Claude 3.7 Sonnet (Vers치til)</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">
                            Temperatura del modelo (0-1)
                            <span class="info-tooltip" data-bs-toggle="tooltip" title="0 = M치s predecible, 1 = M치s creativo. Recomendado: 0 para consistencia">?</span>
                        </label>
                        <input type="number" class="form-control" id="temperature" min="0" max="1" step="0.1" value="0">
                        <small class="text-muted">Valor actual: <strong>0</strong> (m치xima consistencia)</small>
                    </div>
                </div>
                
                <div class="config-section">
                    <div class="config-section-title">
                        <i class="bi bi-mic-fill"></i>
                        Configuraci칩n de voz
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">ID de voz (Voice ID)</label>
                        <input type="text" class="form-control" id="voiceId" placeholder="Ej: custom_voice_a24ff2d6349ee726c14d64cb67">
                        <small class="text-muted">ID de la voz configurada en Retell AI (puedes dejarlo vac칤o para usar la voz por defecto)</small>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Velocidad de voz (0.5-2.0)</label>
                            <input type="number" class="form-control" id="voiceSpeed" min="0.5" max="2" step="0.1" value="1">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Temperatura de voz (0-1)</label>
                            <input type="number" class="form-control" id="voiceTemperature" min="0" max="1" step="0.1" value="0.8">
                        </div>
                    </div>
                </div>
                
                <div class="config-section">
                    <div class="config-section-title">
                        <i class="bi bi-clock-fill"></i>
                        Tiempos y sensibilidad
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                Responsividad (0-1)
                                <span class="info-tooltip" data-bs-toggle="tooltip" title="Qu칠 tan r치pido responde el agente. Recomendado: 0.98">?</span>
                            </label>
                            <input type="number" class="form-control" id="responsiveness" min="0" max="1" step="0.01" value="0.98">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                Sensibilidad a interrupciones (0-1)
                                <span class="info-tooltip" data-bs-toggle="tooltip" title="Facilidad para que el usuario interrumpa. Recomendado: 0.8">?</span>
                            </label>
                            <input type="number" class="form-control" id="interruptionSensitivity" min="0" max="1" step="0.1" value="0.8">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Duraci칩n m치xima de llamada (segundos)</label>
                            <input type="number" class="form-control" id="maxCallDuration" value="601">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Finalizar tras silencio (segundos)</label>
                            <input type="number" class="form-control" id="endAfterSilence" value="59">
                        </div>
                    </div>
                </div>
                
                <div class="config-section">
                    <div class="config-section-title">
                        <i class="bi bi-link-45deg"></i>
                        Webhook (Opcional)
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">URL del webhook para post-call data</label>
                        <input type="url" class="form-control" id="webhookUrl" placeholder="https://tu-servidor.com/webhook/post-call">
                        <small class="text-muted">Deja vac칤o si no necesitas recibir datos post-llamada</small>
                    </div>
                </div>
            </div>
            
            <!-- PASO 8: Resumen y Creaci칩n -->
            <div class="step-content" data-step="8">
                <div class="section-title">
                    <i class="bi bi-check-circle-fill"></i>
                    Resumen y creaci칩n
                </div>
                <div class="section-subtitle">
                    Revisa la configuraci칩n antes de crear tu agente en Retell AI
                </div>
                
                <div class="alert-custom alert-success">
                    <i class="bi bi-check-circle-fill" style="font-size: 20px;"></i>
                    <div>
                        <strong>춰Todo listo!</strong> Tu configuraci칩n est치 completa. Revisa el resumen y crea tu agente.
                    </div>
                </div>
                
                <!-- Resumen de configuraci칩n -->
                <div class="summary-card">
                    <div class="summary-title">
                        <i class="bi bi-info-circle-fill"></i>
                        Informaci칩n b치sica
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Nombre del agente:</span>
                        <span class="summary-value" id="summaryAgentName">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Empresa:</span>
                        <span class="summary-value" id="summaryCompanyName">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Mensaje inicial:</span>
                        <span class="summary-value" id="summaryBeginMessage">-</span>
                    </div>
                </div>
                
                <div class="summary-card">
                    <div class="summary-title">
                        <i class="bi bi-toggles2"></i>
                        M칩dulos activados
                    </div>
                    <div id="summaryModules">
                        <div class="summary-item">
                            <span class="summary-label">No hay m칩dulos seleccionados</span>
                        </div>
                    </div>
                </div>
                
                <div class="summary-card">
                    <div class="summary-title">
                        <i class="bi bi-cpu-fill"></i>
                        Configuraci칩n t칠cnica
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Modelo de IA:</span>
                        <span class="summary-value" id="summaryModel">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Velocidad de voz:</span>
                        <span class="summary-value" id="summaryVoiceSpeed">-</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Responsividad:</span>
                        <span class="summary-value" id="summaryResponsiveness">-</span>
                    </div>
                </div>
                
                <!-- Bot칩n para ver prompt -->
                <div class="text-center my-4">
                    <button class="btn-preview" onclick="showPromptPreview()">
                        <i class="bi bi-eye-fill"></i> Ver prompt generado
                    </button>
                </div>
                
                <!-- Preview del prompt (oculto inicialmente) -->
                <div id="promptPreviewContainer" class="hidden">
                    <h5 class="mt-4 mb-3"><i class="bi bi-code-slash"></i> Vista previa del prompt</h5>
                    <div class="prompt-preview" id="promptPreview"></div>
                </div>
                
                <!-- Loading spinner -->
                <div class="loading-spinner" id="loadingSpinner">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Creando agente...</span>
                    </div>
                    <p class="mt-3">Creando tu agente en Retell AI...</p>
                </div>
                
                <!-- Resultado de creaci칩n -->
                <div id="creationResult" class="hidden"></div>
            </div>
        </div>
        
        <!-- Actions -->
        <div class="wizard-actions">
            <button class="btn-wizard btn-wizard-prev" id="btnPrev" onclick="previousStep()">
                <i class="bi bi-arrow-left"></i>
                Anterior
            </button>
            <button class="btn-wizard btn-wizard-next" id="btnNext" onclick="nextStep()">
                Siguiente
                <i class="bi bi-arrow-right"></i>
            </button>
            <button class="btn-wizard btn-wizard-create hidden" id="btnCreate" onclick="createAgent()">
                <i class="bi bi-rocket-takeoff-fill"></i>
                Crear agente en Retell AI
            </button>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ============================================
        // CONFIGURACI칍N GLOBAL
        // ============================================
        
        let currentStep = 1;
        const totalSteps = 8;
        
        // IMPORTANTE: Reemplaza esto con tu API Key de Retell AI
        const RETELL_API_KEY = 'key_4bb39d66481caf4b67b3e27d8a3f'; // 游댏 TU API KEY AQU칈
        
        // ============================================
        // NAVEGACI칍N ENTRE PASOS
        // ============================================
        
        function updateStepUI() {
            // Actualizar contenido visible
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelector(`.step-content[data-step="${currentStep}"]`).classList.add('active');
            
            // Actualizar indicadores de progreso
            document.querySelectorAll('.step-item').forEach((item, index) => {
                const stepNum = index + 1;
                item.classList.remove('active', 'completed');
                
                if (stepNum < currentStep) {
                    item.classList.add('completed');
                } else if (stepNum === currentStep) {
                    item.classList.add('active');
                }
            });
            
            // Actualizar botones
            document.getElementById('btnPrev').disabled = currentStep === 1;
            
            if (currentStep === totalSteps) {
                document.getElementById('btnNext').classList.add('hidden');
                document.getElementById('btnCreate').classList.remove('hidden');
                updateSummary();
            } else {
                document.getElementById('btnNext').classList.remove('hidden');
                document.getElementById('btnCreate').classList.add('hidden');
            }
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function nextStep() {
            // Validar paso actual antes de avanzar
            if (!validateCurrentStep()) {
                return;
            }
            
            // Saltar pasos de m칩dulos no activados
            let nextStepNum = currentStep + 1;
            
            // Si vamos al paso 3, 4 o 5, verificar si el m칩dulo est치 activo
            if (nextStepNum === 3 && !document.getElementById('moduleCualificacion').checked) {
                nextStepNum = 4;
            }
            if (nextStepNum === 4 && !document.getElementById('moduleTransferencia').checked) {
                nextStepNum = 5;
            }
            if (nextStepNum === 5 && !document.getElementById('moduleAgendamiento').checked) {
                nextStepNum = 6;
            }
            
            if (nextStepNum <= totalSteps) {
                currentStep = nextStepNum;
                updateStepUI();
            }
        }
        
        function previousStep() {
            let prevStepNum = currentStep - 1;
            
            // Saltar pasos de m칩dulos no activados al retroceder
            if (prevStepNum === 5 && !document.getElementById('moduleAgendamiento').checked) {
                prevStepNum = 4;
            }
            if (prevStepNum === 4 && !document.getElementById('moduleTransferencia').checked) {
                prevStepNum = 3;
            }
            if (prevStepNum === 3 && !document.getElementById('moduleCualificacion').checked) {
                prevStepNum = 2;
            }
            
            if (prevStepNum >= 1) {
                currentStep = prevStepNum;
                updateStepUI();
            }
        }
        
        // ============================================
        // VALIDACI칍N DE PASOS
        // ============================================
        
        function validateCurrentStep() {
            switch(currentStep) {
                case 1:
                    // Validar informaci칩n b치sica
                    const agentName = document.getElementById('agentName').value.trim();
                    const companyName = document.getElementById('companyName').value.trim();
                    
                    if (!agentName) {
                        alert('Por favor, ingresa el nombre del agente');
                        return false;
                    }
                    if (!companyName) {
                        alert('Por favor, ingresa el nombre de la empresa');
                        return false;
                    }
                    return true;
                    
                case 2:
                    // Validar que al menos un m칩dulo est칠 seleccionado
                    const anyModuleSelected = 
                        document.getElementById('moduleCualificacion').checked ||
                        document.getElementById('moduleTransferencia').checked ||
                        document.getElementById('moduleAgendamiento').checked;
                    
                    if (!anyModuleSelected) {
                        alert('Por favor, selecciona al menos una capacidad para tu agente');
                        return false;
                    }
                    return true;
                    
                case 5:
                    // Si el m칩dulo de agendamiento est치 activo, validar Cal.com
                    if (document.getElementById('moduleAgendamiento').checked) {
                        const calApiKey = document.getElementById('calApiKey').value.trim();
                        const calEventTypeId = document.getElementById('calEventTypeId').value.trim();
                        
                        if (!calApiKey) {
                            alert('Por favor, ingresa tu Cal.com API Key');
                            return false;
                        }
                        if (!calEventTypeId) {
                            alert('Por favor, ingresa el Event Type ID de Cal.com');
                            return false;
                        }
                    }
                    return true;
                    
                default:
                    return true;
            }
        }
        
        // ============================================
        // INTERACCIONES DE M칍DULOS
        // ============================================
        
        // Hacer que las tarjetas de m칩dulos sean clickeables
        document.querySelectorAll('.module-card').forEach(card => {
            card.addEventListener('click', function(e) {
                if (e.target.type !== 'checkbox') {
                    const checkbox = this.querySelector('.module-checkbox');
                    checkbox.checked = !checkbox.checked;
                    checkbox.dispatchEvent(new Event('change'));
                }
            });
        });
        
        // Toggle visual de m칩dulos
        document.querySelectorAll('.module-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const card = this.closest('.module-card');
                if (this.checked) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
        });
        
        // Toggle visual de opciones de personalidad
        document.querySelectorAll('.personality-option').forEach(option => {
            option.addEventListener('click', function() {
                const radio = this.querySelector('input[type="radio"]');
                radio.checked = true;
                
                document.querySelectorAll('.personality-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
            });
        });
        
        // ============================================
        // ACTUALIZAR RESUMEN (PASO 8)
        // ============================================
        
        function updateSummary() {
            // Informaci칩n b치sica
            document.getElementById('summaryAgentName').textContent = 
                document.getElementById('agentName').value || '-';
            document.getElementById('summaryCompanyName').textContent = 
                document.getElementById('companyName').value || '-';
            document.getElementById('summaryBeginMessage').textContent = 
                document.getElementById('beginMessage').value || '-';
            
            // M칩dulos activados
            const modulesContainer = document.getElementById('summaryModules');
            modulesContainer.innerHTML = '';
            
            const modules = [
                { id: 'moduleCualificacion', name: 'Cualificaci칩n de contactos', icon: 'patch-question-fill' },
                { id: 'moduleTransferencia', name: 'Transferencia de llamadas', icon: 'telephone-forward-fill' },
                { id: 'moduleAgendamiento', name: 'Agendamiento de citas', icon: 'calendar-check-fill' }
            ];
            
            let anyModuleActive = false;
            modules.forEach(module => {
                if (document.getElementById(module.id).checked) {
                    anyModuleActive = true;
                    const item = document.createElement('div');
                    item.className = 'summary-item';
                    item.innerHTML = `
                        <span class="summary-label"><i class="bi bi-${module.icon}"></i> ${module.name}</span>
                        <span class="summary-value" style="color: var(--netelip-success);">九 Activado</span>
                    `;
                    modulesContainer.appendChild(item);
                }
            });
            
            if (!anyModuleActive) {
                modulesContainer.innerHTML = '<div class="summary-item"><span class="summary-label">No hay m칩dulos seleccionados</span></div>';
            }
            
            // Configuraci칩n t칠cnica
            const modelSelect = document.getElementById('modelSelect');
            document.getElementById('summaryModel').textContent = 
                modelSelect.options[modelSelect.selectedIndex].text;
            document.getElementById('summaryVoiceSpeed').textContent = 
                document.getElementById('voiceSpeed').value + 'x';
            document.getElementById('summaryResponsiveness').textContent = 
                document.getElementById('responsiveness').value;
        }
        
        // ============================================
        // GENERACI칍N DEL PROMPT
        // ============================================
        
        function generatePrompt() {
            const agentName = document.getElementById('agentName').value;
            const companyName = document.getElementById('companyName').value;
            const services = document.getElementById('services').value;
            const objective = document.getElementById('mainObjective').value;
            
            // M칩dulos activos
            const cualificacionActive = document.getElementById('moduleCualificacion').checked;
            const transferenciaActive = document.getElementById('moduleTransferencia').checked;
            const agendamientoActive = document.getElementById('moduleAgendamiento').checked;
            
            // Construir el prompt basado en la plantilla de Elio
            let prompt = `## Rol y Objetivo
Eres ${agentName} y tu objetivo es ${objective} de ${companyName}.

## Personalidad
- Eres cercano, emp치tico y amable. 
- Vas al grano siendo eficiente, pero siempre manteniendo un tono c치lido y profesional. 
- Eres paciente y consistente, especialmente cuando el contacto no tiene claro qu칠 necesita.

## Contexto
- Eres un asistente de IA, no un humano.
- Evita SIEMPRE ofrecer asesoramiento t칠cnico ni resolver configuraciones de servicios.`;

            if (services) {
                prompt += `\n- Tienes acceso a una knowledge base sobre servicios de ${companyName}: ${services}`;
            }

            prompt += `
- Hora actual: {{current_time_Europe/Madrid}}
- Tel칠fono del contacto: {{numero_telefono}}
- Nombre del contacto: {{user_name}}
- Email: {{email}}

## Instrucciones
### Estilos de comunicaci칩n
- Haz solo una pregunta a la vez y espera respuesta (no digas "쮺u치l es tu nombre y en qu칠 puedo ayudarte?"; en su lugar pregunta "쮺u치l es tu nombre?", espera la respuesta, y luego pregunta "쮼n qu칠 puedo ayudarte?")
- Mant칠n las interacciones breves con oraciones cortas
- Esta es una conversaci칩n de voz con potencial retraso (2 mensajes cortados seguidos) y errores de transcripci칩n (palabras equivocadas), as칤 que ad치ptate en consecuencia. Considera el contexto para aclarar informaci칩n ambigua o mal transcrita
- Si recibes un mensaje obviamente incompleto, responde: "uhm"
- Escribe los s칤mbolos como palabras: "tres euros" no "3", "arroba" no "@"
- Menciona la zona horaria (hora de Madrid) una vez al inicio si es relevante, no la repitas durante la llamada
- Presta atenci칩n a la informaci칩n que el contacto ya ha compartido - Si mencionan su nombre, empresa o motivo mientras responden otra pregunta, recon칩celo y no vuelvas a preguntarlo
- Al ofrecer opciones (ej. horarios de citas), limita las opciones a 2 m치ximo
- Var칤a las respuestas entusiastas (${document.getElementById('enthusiasticWords').value}) - Evita repeticiones
- Maneja preguntas sobre IA con humor y transparencia: si preguntan "쮼res un robot?" o "쮼res real?", responde "No soy un robot, soy un agente de voz creado con inteligencia artificial" y luego redirige al objetivo principal de la llamada`;

            if (services) {
                prompt += `\n- Considera la knowledge base proporcionada para aclarar cualquier informaci칩n ambigua o confusa sobre los servicios de ${companyName} para contactos que NO son clientes.`;
            }

            const fillerWords = document.getElementById('fillerWords').value;
            if (fillerWords) {
                prompt += `\n- Usa palabras de relleno naturales (${fillerWords}) de forma muy limitada - m치ximo una cada 4 interacciones`;
            }

            prompt += `

###  Reglas de comunicaci칩n
- M치ximo 30 segundos por respuesta
- Usa el {{user_name}} frecuentemente una vez lo tengas capturado
- Lee las fechas de forma natural y con palabras completas: "lunes quince de abril a las seis y media de la tarde" no "15/04 a las 18:30"

### Herramientas`;

            // M칍DULO TRANSFERENCIA
            if (transferenciaActive) {
                const transfer1Name = document.getElementById('transfer1Name').value;
                const transfer1Criteria = document.getElementById('transfer1Criteria').value;
                const transfer1Message = document.getElementById('transfer1Message').value;
                
                const transfer2Name = document.getElementById('transfer2Name').value;
                const transfer2Criteria = document.getElementById('transfer2Criteria').value;
                const transfer2Message = document.getElementById('transfer2Message').value;
                
                if (transfer1Name) {
                    prompt += `
**transfer_call_${transfer1Name.toLowerCase().replace(/\s+/g, '_')}**  
- Si el contacto ${transfer1Criteria}, di: "${transfer1Message}" y luego ejecuta inmediatamente la funci칩n transfer_call_${transfer1Name.toLowerCase().replace(/\s+/g, '_')}`;
                }
                
                if (transfer2Name) {
                    prompt += `

**transfer_call_${transfer2Name.toLowerCase().replace(/\s+/g, '_')}**  
- Si el contacto ${transfer2Criteria}, di: "${transfer2Message}" y luego ejecuta inmediatamente la funci칩n transfer_call_${transfer2Name.toLowerCase().replace(/\s+/g, '_')}`;
                }
            }

            // M칍DULO AGENDAMIENTO
            if (agendamientoActive) {
                const checkAvailMessage = document.getElementById('checkAvailabilityMessage').value;
                const confirmMessage = document.getElementById('confirmationMessage').value;
                
                prompt += `

**reservar_cal**  
- Usa SOLO despu칠s de confirmar que el contacto NO es cliente de ${companyName} y despu칠s de acordar un horario espec칤fico disponible
- Cuando el contacto acepta agendar una cita, di: "${checkAvailMessage || 'Excelente. D칠jame consultar qu칠 horarios tenemos disponibles...'}" y consulta la disponibilidad {{consultar_disponibilidad}}
- El sistema te proporcionar치 autom치ticamente los 2 horarios m치s tempranos en la {{disponibilidad_mas_temprana}}
- Ofrece las opciones diciendo: "Tenemos disponibilidad el {{disponibilidad_mas_temprana}}. 쮺u치l te viene mejor?"
- Si el contacto pregunta por m치s opciones o ninguna de las 2 le funciona, consulta nuevamente {{consultar_disponibilidad}} para mostrar toda la disponibilidad de los pr칩ximos 6 d칤as
- Cuando el contacto acepta un horario espec칤fico, di: "Estupendo. Ahora necesito que me confirmes el n칰mero de tel칠fono al que quieres que te llamen."
- Una vez captures el {{numero_telefono}}, confirma con el usuario su correo electr칩nico, di: "Genial y para terminar, 쯇uedes darme tu correo electr칩nico?"
- SOLO despu칠s de que el contacto confirme que el email y su n칰mero de tel칠fono es correcto, di: "Perfecto, d칠jame confirmar tu cita, un momento por favor..." y ejecuta inmediatamente la funci칩n reservar_cal.
- Despu칠s de ejecutar reservar_cal exitosamente, confirma: "${confirmMessage || 'Listo, {{user_name}}. Tu cita est치 confirmada para el [repite la fecha/hora que acept칩], hora de Madrid. Recibir치s un correo de confirmaci칩n.'}"`;
            }

            // END CALL (siempre incluido)
            prompt += `

**end_call**
- Cuando el usuario dice adi칩s o la conversaci칩n llega al final del flujo, activa la funci칩n end_call para finalizar la llamada de forma cordial.`;

            // M칍DULO CUALIFICACI칍N
            if (cualificacionActive) {
                const q1 = document.getElementById('q1').value;
                const q2 = document.getElementById('q2').value;
                const q3 = document.getElementById('q3').value;
                
                prompt += `

### Preguntas de cualificaci칩n
Haz las siguientes preguntas para determinar si el contacto es cliente de ${companyName} y hacia d칩nde dirigirlo. Haz una pregunta a la vez y adapta seg칰n lo que compartan:

**Q1:** "${q1 || '쮼res ya cliente de ' + companyName + ' o quieres informaci칩n para empezar?'}"
**Q2:** "${q2 || '쮼n qu칠 puedo ayudarte?'}"
**Q3 (solo NO clientes):** "${q3 || '쯊e gustar칤a agendar una cita con un asesor para que te d칠 informaci칩n m치s detallada?'}"

**Criterios:**`;
                
                if (transferenciaActive) {
                    const transfer1Name = document.getElementById('transfer1Name').value;
                    const transfer2Name = document.getElementById('transfer2Name').value;
                    prompt += `
- Cliente + ${transfer1Name || 'Comercial'}: transfer_call_${(transfer1Name || 'comercial').toLowerCase().replace(/\s+/g, '_')}
- Cliente + ${transfer2Name || 'T칠cnico'}: transfer_call_${(transfer2Name || 'tecnico').toLowerCase().replace(/\s+/g, '_')}`;
                }
                
                if (agendamientoActive) {
                    prompt += `
- NO cliente: Responde con la KB + Ofrece agendar`;
                }
            }

            // ETAPAS
            prompt += `

## Etapas`;

            let etapaNum = 1;
            
            // Etapa 1: Saludo (siempre incluida)
            if (cualificacionActive) {
                prompt += `

### ${etapaNum}. Saludo y Cualificaci칩n
- Pregunta nombre al contacto y si es cliente o NO de ${companyName}.`;
                etapaNum++;
            } else {
                prompt += `

### ${etapaNum}. Saludo
- Saluda al contacto y pregunta su nombre.`;
                etapaNum++;
            }
            
            // Etapa Routing (solo si transferencia est치 activa)
            if (transferenciaActive) {
                const transfer1Name = document.getElementById('transfer1Name').value;
                const transfer2Name = document.getElementById('transfer2Name').value;
                
                prompt += `

### ${etapaNum}. Routing
- Si ES cliente: pregunta motivo y transfiere (transfer_call_${(transfer1Name || 'atencion').toLowerCase().replace(/\s+/g, '_')} o transfer_call_${(transfer2Name || 'soporte').toLowerCase().replace(/\s+/g, '_')}).`;
                
                if (agendamientoActive) {
                    prompt += `
- Si NO es cliente: responde con knowledge base y ofrece agendar cita`;
                }
                etapaNum++;
            }
            
            // Etapa Agendamiento
            if (agendamientoActive) {
                prompt += `

### ${etapaNum}. Agendamiento
- Ofrece {{disponibilidad_mas_temprana}}. 
- Si acepta horario, solicita el {{numero_telefono}} y el email
- Espera que el usuario lo deletree y captura en la variable {{email}}, pero no lo deletrees al contacto.
- Ejecuta la funci칩n reservar_cal.`;
                etapaNum++;
            }
            
            // Etapa Cierre (siempre incluida)
            prompt += `

### ${etapaNum}. Cierre
- Pregunta: "쮿ay algo m치s en lo que pueda ayudarte?"
- Espera la respuesta del contacto
- Si dice que no, desp칤dete usando {{user_name}}`;
            
            if (agendamientoActive) {
                prompt += `, menciona {{disponibilidad_mas_temprana}} si agend칩 cita`;
            }
            
            prompt += `, y desea al contacto un gran d칤a
- Despu칠s de completar la despedida, ejecuta end_call`;

            return prompt;
        }
        
        function showPromptPreview() {
            const prompt = generatePrompt();
            document.getElementById('promptPreview').textContent = prompt;
            document.getElementById('promptPreviewContainer').classList.remove('hidden');
        }
        
        // ============================================
        // CREAR AGENTE EN RETELL AI
        // ============================================
        
        async function createAgent() {
            // Validar que hay API key
            if (!RETELL_API_KEY || RETELL_API_KEY === 'TU_API_KEY_AQUI') {
                alert('丘멆잺 Por favor, configura tu API Key de Retell AI en la l칤nea 1057 del c칩digo.');
                return;
            }
            
            // Mostrar loading
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('btnCreate').disabled = true;
            
            try {
                // 1. CREAR EL RETELL LLM
                const llmConfig = {
                    general_prompt: generatePrompt(),
                    begin_message: document.getElementById('beginMessage').value || 
                        `Hola, soy ${document.getElementById('agentName').value}, tu asistente de voz creado con inteligencia artificial de ${document.getElementById('companyName').value}`,
                    model: document.getElementById('modelSelect').value,
                    model_temperature: parseFloat(document.getElementById('temperature').value),
                    tool_call_strict_mode: true,
                    default_dynamic_variables: {
                        "user_name": "Captura el nombre del contacto cuando lo comparta",
                        "email": "Captura el correo electr칩nico del contacto. Es OBLIGATORIO capturarlo antes de ejecutar reservar_cal",
                        "numero_telefono": "Confirma el n칰mero de tel칠fono con el usuario"
                    }
                };
                
                // Agregar tools seg칰n m칩dulos activos
                llmConfig.general_tools = [];
                
                // Tool: end_call (siempre incluida)
                llmConfig.general_tools.push({
                    type: "end_call",
                    name: "end_call",
                    description: "Finaliza la llamada de forma cordial cuando el usuario dice adi칩s o la conversaci칩n llega a su fin"
                });
                
                // Tools de transferencia
                if (document.getElementById('moduleTransferencia').checked) {
                    const transfer1Name = document.getElementById('transfer1Name').value;
                    const transfer1Number = document.getElementById('transfer1Number').value;
                    
                    if (transfer1Name && transfer1Number) {
                        llmConfig.general_tools.push({
                            type: "transfer_call",
                            name: `transfer_call_${transfer1Name.toLowerCase().replace(/\s+/g, '_')}`,
                            description: `Transferir llamada a ${transfer1Name}`,
                            transfer_destination: {
                                type: "predefined",
                                value: "operator",
                                number: transfer1Number
                            }
                        });
                    }
                    
                    const transfer2Name = document.getElementById('transfer2Name').value;
                    const transfer2Number = document.getElementById('transfer2Number').value;
                    
                    if (transfer2Name && transfer2Number) {
                        llmConfig.general_tools.push({
                            type: "transfer_call",
                            name: `transfer_call_${transfer2Name.toLowerCase().replace(/\s+/g, '_')}`,
                            description: `Transferir llamada a ${transfer2Name}`,
                            transfer_destination: {
                                type: "predefined",
                                value: "operator",
                                number: transfer2Number
                            }
                        });
                    }
                }
                
                // Tool de agendamiento
                if (document.getElementById('moduleAgendamiento').checked) {
                    const calApiKey = document.getElementById('calApiKey').value;
                    const calUrl = document.getElementById('calendarUrl').value;
                    const calEventTypeId = parseInt(document.getElementById('calEventTypeId').value);
                    
                    if (calApiKey && calEventTypeId) {
                        llmConfig.general_tools.push({
                            type: "book_appointment_cal",
                            name: "reservar_cal",
                            description: "Reservar cita en el calendario Cal.com con el horario acordado",
                            calendar_url: calUrl || "cal.com",
                            cal_api_key: calApiKey,
                            event_type_id: calEventTypeId
                        });
                        
                        // Agregar variable de disponibilidad
                        llmConfig.default_dynamic_variables.consultar_disponibilidad = "activa esta variable para consultar autom치ticamente la disponibilidad de los pr칩ximos 3 d칤as ANTES de ofrecer horarios al contacto";
                        llmConfig.default_dynamic_variables.disponibilidad_mas_temprana = "Proporciona los 2 primeros horarios disponibles en lenguaje natural espa침ol";
                    }
                }
                
                console.log('Creando LLM con config:', llmConfig);
                
                const llmResponse = await fetch('https://api.retellai.com/v2/create-retell-llm', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${RETELL_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(llmConfig)
                });
                
                if (!llmResponse.ok) {
                    const errorData = await llmResponse.json();
                    throw new Error(`Error al crear LLM: ${errorData.message || llmResponse.statusText}`);
                }
                
                const llmData = await llmResponse.json();
                console.log('LLM creado:', llmData);
                
                // 2. CREAR EL AGENT
                const agentConfig = {
                    agent_name: `${document.getElementById('agentName').value} - ${document.getElementById('companyName').value}`,
                    response_engine: {
                        type: "retell-llm",
                        llm_id: llmData.llm_id
                    },
                    voice_id: document.getElementById('voiceId').value || undefined,
                    voice_speed: parseFloat(document.getElementById('voiceSpeed').value),
                    voice_temperature: parseFloat(document.getElementById('voiceTemperature').value),
                    responsiveness: parseFloat(document.getElementById('responsiveness').value),
                    interruption_sensitivity: parseFloat(document.getElementById('interruptionSensitivity').value),
                    language: "es-ES",
                    max_call_duration_ms: parseInt(document.getElementById('maxCallDuration').value) * 1000,
                    end_call_after_silence_ms: parseInt(document.getElementById('endAfterSilence').value) * 1000,
                    webhook_url: document.getElementById('webhookUrl').value || undefined,
                    enable_backchannel: false,
                    normalize_for_speech: true
                };
                
                console.log('Creando Agent con config:', agentConfig);
                
                const agentResponse = await fetch('https://api.retellai.com/v2/create-agent', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${RETELL_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(agentConfig)
                });
                
                if (!agentResponse.ok) {
                    const errorData = await agentResponse.json();
                    throw new Error(`Error al crear Agent: ${errorData.message || agentResponse.statusText}`);
                }
                
                const agentData = await agentResponse.json();
                console.log('Agent creado:', agentData);
                
                // Mostrar resultado exitoso
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('creationResult').innerHTML = `
                    <div class="alert-custom alert-success">
                        <i class="bi bi-check-circle-fill" style="font-size: 24px;"></i>
                        <div>
                            <strong>춰Agente creado exitosamente!</strong>
                            <br><br>
                            <strong>Agent ID:</strong> <code>${agentData.agent_id}</code>
                            <br>
                            <strong>LLM ID:</strong> <code>${llmData.llm_id}</code>
                            <br><br>
                            Tu agente est치 listo para recibir llamadas. Puedes probarlo en el dashboard de Retell AI.
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <a href="https://beta.retellai.com/dashboard" target="_blank" class="btn-wizard btn-wizard-next">
                            <i class="bi bi-box-arrow-up-right"></i>
                            Ir al Dashboard de Retell AI
                        </a>
                    </div>
                `;
                document.getElementById('creationResult').classList.remove('hidden');
                
                // Guardar en localStorage para referencia
                const agentInfo = {
                    agent_id: agentData.agent_id,
                    llm_id: llmData.llm_id,
                    agent_name: agentConfig.agent_name,
                    created_at: new Date().toISOString(),
                    config: {
                        agentName: document.getElementById('agentName').value,
                        companyName: document.getElementById('companyName').value,
                        modules: {
                            cualificacion: document.getElementById('moduleCualificacion').checked,
                            transferencia: document.getElementById('moduleTransferencia').checked,
                            agendamiento: document.getElementById('moduleAgendamiento').checked
                        }
                    }
                };
                
                // Guardar en array de agentes creados
                let createdAgents = JSON.parse(localStorage.getItem('created_agents') || '[]');
                createdAgents.push(agentInfo);
                localStorage.setItem('created_agents', JSON.stringify(createdAgents));
                
            } catch (error) {
                console.error('Error al crear agente:', error);
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('creationResult').innerHTML = `
                    <div class="alert-custom" style="background: rgba(220, 53, 69, 0.1); color: var(--netelip-danger);">
                        <i class="bi bi-exclamation-triangle-fill" style="font-size: 24px;"></i>
                        <div>
                            <strong>Error al crear el agente</strong>
                            <br><br>
                            ${error.message}
                            <br><br>
                            <small>Verifica tu API Key y que todos los datos sean correctos. Revisa la consola del navegador para m치s detalles.</small>
                        </div>
                    </div>
                `;
                document.getElementById('creationResult').classList.remove('hidden');
                document.getElementById('btnCreate').disabled = false;
            }
        }
        
        // ============================================
        // GENERACI칍N AUTOM츼TICA DEL MENSAJE INICIAL
        // ============================================
        
        function autoGenerateBeginMessage() {
            const name = document.getElementById('agentName').value.trim();
            const company = document.getElementById('companyName').value.trim();
            
            if (name && company) {
                // Generar mensaje con cumplimiento GDPR/LOPD
                const message = `Hola, soy ${name}, tu asistente de voz creado con inteligencia artificial de ${company}. Esta llamada puede ser grabada con fines de calidad. 쮺on qui칠n tengo el gusto de hablar?`;
                document.getElementById('beginMessage').value = message;
            }
        }
        
        // ============================================
        // INICIALIZACI칍N
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar tooltips de Bootstrap
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // Marcar opci칩n de personalidad por defecto como selected
            document.querySelector('.personality-option[data-personality="standard"]').classList.add('selected');
            
            // Auto-generar mensaje inicial cuando cambian nombre o empresa
            document.getElementById('agentName').addEventListener('input', autoGenerateBeginMessage);
            document.getElementById('companyName').addEventListener('input', autoGenerateBeginMessage);
            
            console.log('九 Generador de Prompts Netelip inicializado correctamente');
            console.log('游댐 Recuerda configurar tu RETELL_API_KEY en la l칤nea 1057');
        });
    </script>
</body>
</html>
